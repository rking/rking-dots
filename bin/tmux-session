#!/bin/sh -x
# Start or reattach to a session, using ~/.$1-tmux.conf
THISSERV="tmux -2 -L $1"
CONFFILE=~/.$1-tmux.conf

[ -e $CONFFILE ] || (echo "No $CONFFILE found."; exit 1)

unset TMUX # Big-boy mode: allows running even if nested. (Which easily occurs
           # if you start one terminal from another.)

if $THISSERV list-sessions; then
    $THISSERV attach
else
    $THISSERV -f $CONFFILE \
        start-server\; \
        source-file ~/.tmux.conf\; \
        rename-session $1\; \
        attach
fi
